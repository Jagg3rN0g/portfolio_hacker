---
import ProjectCard from "./ProjectCard.astro";

interface Repo {
    name: string;
    description: string;
    stargazers_count: number;
    html_url: string;
    language: string;
    fork: boolean;
}

const fetchProjects = async () => {
    try {
        const response = await fetch(
            "https://api.github.com/users/jagg3rsec/repos",
        );
        if (!response.ok) return [];
        const repos: Repo[] = await response.json();

        return repos
            .filter((repo) => !repo.fork) // Show only source projects
            .sort((a, b) => b.stargazers_count - a.stargazers_count) // Sort by stars
            .slice(0, 6) // Limit to top 6
            .map((repo) => ({
                title: repo.name,
                description: repo.description || "No description available.",
                tags: repo.language ? [repo.language] : [],
                stars: repo.stargazers_count,
                url: repo.html_url,
            }));
    } catch (e) {
        console.error("Error fetching repos:", e);
        return [];
    }
};

const projects = await fetchProjects();
---

<section id="projects" class="py-20 max-w-6xl mx-auto px-4">
    <div class="flex items-end gap-4 mb-12">
        <h2 class="text-3xl md:text-4xl font-bold text-white">
            <span class="text-accent-red">./</span>projects
        </h2>
        <div class="h-px bg-gray-800 flex-1 mb-2"></div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {projects.map((project) => <ProjectCard {...project} />)}
    </div>
</section>
